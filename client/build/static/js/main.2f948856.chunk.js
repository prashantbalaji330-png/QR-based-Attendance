(this["webpackJsonpqr-attendance-client"]=this["webpackJsonpqr-attendance-client"]||[]).push([[0],{27:function(e,t,s){},33:function(e,t,s){"use strict";s.r(t);var a=s(1),c=s.n(a),l=s(18),r=s.n(l),n=s(8),d=s(7),i=(s(25),s(26),s(27),s(4)),o=s(34),j=s(0);const b=Object(a.createContext)(),m={user:null,token:localStorage.getItem("token"),isAuthenticated:!1,loading:!0,error:null},h=(e,t)=>{switch(t.type){case"LOGIN_START":return{...e,loading:!0,error:null};case"LOGIN_SUCCESS":return{...e,user:t.payload.data,token:t.payload.data.token,isAuthenticated:!0,loading:!1,error:null};case"LOGIN_FAILURE":return{...e,user:null,token:null,isAuthenticated:!1,loading:!1,error:t.payload};case"LOGOUT":return{...e,user:null,token:null,isAuthenticated:!1,loading:!1,error:null};case"UPDATE_USER":return{...e,user:{...e.user,...t.payload}};case"SET_LOADING":return{...e,loading:t.payload};default:return e}},x=e=>{let{children:t}=e;const[s,c]=Object(a.useReducer)(h,m);Object(a.useEffect)(()=>{s.token?(o.a.defaults.headers.common.Authorization=`Bearer ${s.token}`,localStorage.setItem("token",s.token)):(delete o.a.defaults.headers.common.Authorization,localStorage.removeItem("token"))},[s.token]),Object(a.useEffect)(()=>{(async()=>{const e=localStorage.getItem("token");if(console.log("AuthContext - Checking auth with token:",e?"Present":"Missing"),e)try{o.a.defaults.headers.common.Authorization=`Bearer ${e}`,console.log("AuthContext - Set axios header with token");const t=await o.a.get("/api/auth/me");console.log("AuthContext - Auth check successful:",t.data.data),c({type:"LOGIN_SUCCESS",payload:{data:t.data.data}})}catch(t){console.error("AuthContext - Auth check failed:",t),delete o.a.defaults.headers.common.Authorization,localStorage.removeItem("token"),c({type:"LOGOUT"})}else console.log("AuthContext - No token found, setting loading to false"),c({type:"SET_LOADING",payload:!1}),s.isAuthenticated&&c({type:"LOGOUT"})})()},[]);const l={user:s.user,token:s.token,isAuthenticated:s.isAuthenticated,loading:s.loading,error:s.error,login:async(e,t)=>{console.log("AuthContext - Starting login process"),c({type:"LOGIN_START"});try{const s=await o.a.post("/api/auth/login",{email:e,password:t});console.log("AuthContext - Login response:",s.data);const a=s.data.data.token,l=s.data.data;return console.log("AuthContext - Setting token:",a?"Present":"Missing"),console.log("AuthContext - User data:",l),o.a.defaults.headers.common.Authorization=`Bearer ${a}`,localStorage.setItem("token",a),c({type:"LOGIN_SUCCESS",payload:{data:l}}),console.log("AuthContext - Login successful, user data:",l),d.b.success("Login successful!"),{success:!0,user:l}}catch(l){var s,a;console.error("AuthContext - Login failed:",l);const e=(null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Login failed";return c({type:"LOGIN_FAILURE",payload:e}),d.b.error(e),{success:!1,error:e}}},register:async e=>{c({type:"LOGIN_START"});try{const t=await o.a.post("/api/auth/register",e),s=t.data.data.token;return o.a.defaults.headers.common.Authorization=`Bearer ${s}`,localStorage.setItem("token",s),c({type:"LOGIN_SUCCESS",payload:t.data}),d.b.success("Registration successful!"),{success:!0}}catch(a){var t,s;const e=(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Registration failed";return c({type:"LOGIN_FAILURE",payload:e}),d.b.error(e),{success:!1,error:e}}},logout:()=>{delete o.a.defaults.headers.common.Authorization,localStorage.removeItem("token"),c({type:"LOGOUT"}),d.b.info("Logged out successfully")},clearAuthState:()=>{console.log("AuthContext - Clearing corrupted auth state"),delete o.a.defaults.headers.common.Authorization,localStorage.removeItem("token"),sessionStorage.clear(),c({type:"LOGOUT"}),setTimeout(()=>{window.location.reload()},100)},updateProfile:async e=>{try{const t=await o.a.put("/api/auth/me",e);return c({type:"UPDATE_USER",payload:t.data.data}),d.b.success("Profile updated successfully!"),{success:!0}}catch(a){var t,s;const e=(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Profile update failed";return d.b.error(e),{success:!1,error:e}}},changePassword:async(e,t)=>{try{return await o.a.put("/api/auth/change-password",{currentPassword:e,newPassword:t}),d.b.success("Password changed successfully!"),{success:!0}}catch(c){var s,a;const e=(null===(s=c.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Password change failed";return d.b.error(e),{success:!1,error:e}}}};return Object(j.jsx)(b.Provider,{value:l,children:t})},O=()=>{const e=Object(a.useContext)(b);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};var u=s(5);var N=()=>{const{user:e,logout:t}=O(),s=Object(i.q)(),[c,l]=Object(a.useState)(!1);return Object(j.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light",children:Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)(n.b,{className:"navbar-brand",to:"/",children:"\ud83d\udcf1 QR Attendance System"}),Object(j.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav",children:Object(j.jsx)("span",{className:"navbar-toggler-icon"})}),Object(j.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarNav",children:[Object(j.jsxs)("ul",{className:"navbar-nav me-auto",children:[Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(n.b,{className:"nav-link",to:"teacher"===(null===e||void 0===e?void 0:e.role)?"/teacher":"/student",children:"Dashboard"})}),"teacher"===(null===e||void 0===e?void 0:e.role)&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(n.b,{className:"nav-link",to:"/teacher/qr-generate",children:"Generate QR"})}),Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(n.b,{className:"nav-link",to:"/teacher/attendance",children:"View Attendance"})})]}),"student"===(null===e||void 0===e?void 0:e.role)&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(n.b,{className:"nav-link",to:"/student/scan",children:"Scan QR"})}),Object(j.jsx)("li",{className:"nav-item",children:Object(j.jsx)(n.b,{className:"nav-link",to:"/student/my-attendance",children:"My Attendance"})})]})]}),Object(j.jsx)("div",{className:"navbar-nav",children:Object(j.jsxs)("div",{className:"nav-item dropdown",children:[Object(j.jsxs)("button",{className:"btn btn-link nav-link dropdown-toggle",onClick:()=>l(!c),children:[Object(j.jsx)(u.u,{className:"me-1"}),null===e||void 0===e?void 0:e.name]}),c&&Object(j.jsxs)("div",{className:"dropdown-menu show",children:[Object(j.jsxs)(n.b,{className:"dropdown-item",to:"/profile",children:[Object(j.jsx)(u.g,{className:"me-2"}),"Profile"]}),Object(j.jsxs)("button",{className:"dropdown-item",onClick:()=>{t(),s("/login")},children:[Object(j.jsx)(u.r,{className:"me-2"}),"Logout"]})]})]})})]})]})})};var v=()=>{const[e,t]=Object(a.useState)({email:"",password:""}),[s,c]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1),{login:d}=O(),o=Object(i.q)(),b=s=>{t({...e,[s.target.name]:s.target.value})};return Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5",children:[Object(j.jsxs)("div",{className:"text-center mb-4",children:[Object(j.jsx)("h2",{className:"fw-bold text-primary",children:"Welcome Back"}),Object(j.jsx)("p",{className:"text-muted",children:"Sign in to your account"})]}),Object(j.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),r(!0);try{const t=await d(e.email,e.password);if(t.success){var s;console.log("Login successful, navigating..."),console.log("User data:",t.user);const e=null===(s=t.user)||void 0===s?void 0:s.role;o("teacher"===e?"/teacher":"student"===e?"/student":"/")}}catch(a){console.error("Login error:",a)}finally{r(!1)}},children:[Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email Address"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.j,{})}),Object(j.jsx)("input",{type:"email",className:"form-control",id:"email",name:"email",value:e.email,onChange:b,required:!0,placeholder:"Enter your email"})]})]}),Object(j.jsxs)("div",{className:"mb-4",children:[Object(j.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:s?"text":"password",className:"form-control",id:"password",name:"password",value:e.password,onChange:b,required:!0,placeholder:"Enter your password"}),Object(j.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>c(!s),children:s?Object(j.jsx)(u.l,{}):Object(j.jsx)(u.k,{})})]})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary w-100 mb-3",disabled:l,children:l?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Signing In..."]}):"Sign In"}),Object(j.jsxs)("div",{className:"text-center",children:[Object(j.jsxs)("p",{className:"mb-0",children:["Don't have an account?"," ",Object(j.jsx)(n.b,{to:"/register",className:"text-primary fw-bold",children:"Sign up here"})]}),Object(j.jsx)("p",{className:"mt-2 mb-0",children:Object(j.jsx)(n.b,{to:"/forgot-password",className:"text-muted text-decoration-none",children:"Forgot your password?"})})]})]})]})})})})};var p=()=>{const[e,t]=Object(a.useState)({name:"",email:"",mobileNumber:"",password:"",confirmPassword:"",role:"student",studentId:"",department:"",year:1}),[s,c]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1),[d,o]=Object(a.useState)(!1),{register:b}=O(),m=Object(i.q)(),h=s=>{t({...e,[s.target.name]:s.target.value})};return Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-8 col-lg-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5",children:[Object(j.jsxs)("div",{className:"text-center mb-4",children:[Object(j.jsx)("h2",{className:"fw-bold text-primary",children:"Create Account"}),Object(j.jsx)("p",{className:"text-muted",children:"Join the QR Attendance System"})]}),Object(j.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),o(!0),e.password!==e.confirmPassword)return alert("Passwords do not match"),void o(!1);if(e.password.length<6)return alert("Password must be at least 6 characters long"),void o(!1);if(e.mobileNumber&&!/^[0-9]{10}$/.test(e.mobileNumber))return alert("Mobile number must be exactly 10 digits"),void o(!1);try{const t={name:e.name,email:e.email,mobileNumber:e.mobileNumber,password:e.password,role:e.role};"student"===e.role&&(t.studentId=e.studentId,t.department=e.department,t.year=parseInt(e.year));(await b(t)).success&&m("/")}catch(s){console.error("Registration error:",s)}finally{o(!1)}},children:[Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"role",className:"form-label",children:"Role"}),Object(j.jsxs)("select",{className:"form-select",id:"role",name:"role",value:e.role,onChange:h,required:!0,children:[Object(j.jsx)("option",{value:"student",children:"Student"}),Object(j.jsx)("option",{value:"teacher",children:"Teacher"})]})]}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"name",className:"form-label",children:"Full Name"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.u,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"name",name:"name",value:e.name,onChange:h,required:!0,placeholder:"Enter your full name"})]})]}),Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email Address"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.j,{})}),Object(j.jsx)("input",{type:"email",className:"form-control",id:"email",name:"email",value:e.email,onChange:h,required:!0,placeholder:"Enter your email"})]})]})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"mobileNumber",className:"form-label",children:"Mobile Number"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.p,{})}),Object(j.jsx)("input",{type:"tel",className:"form-control",id:"mobileNumber",name:"mobileNumber",value:e.mobileNumber,onChange:h,required:!0,placeholder:"Enter your 10-digit mobile number",maxLength:"10"})]})]}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:s?"text":"password",className:"form-control",id:"password",name:"password",value:e.password,onChange:h,required:!0,placeholder:"Enter password"}),Object(j.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>c(!s),children:s?Object(j.jsx)(u.l,{}):Object(j.jsx)(u.k,{})})]})]}),Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"confirmPassword",className:"form-label",children:"Confirm Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:l?"text":"password",className:"form-control",id:"confirmPassword",name:"confirmPassword",value:e.confirmPassword,onChange:h,required:!0,placeholder:"Confirm password"}),Object(j.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>r(!l),children:l?Object(j.jsx)(u.l,{}):Object(j.jsx)(u.k,{})})]})]})]}),"student"===e.role&&Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-4 mb-3",children:[Object(j.jsx)("label",{htmlFor:"studentId",className:"form-label",children:"Student ID"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.n,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"studentId",name:"studentId",value:e.studentId,onChange:h,required:!0,placeholder:"Enter student ID"})]})]}),Object(j.jsxs)("div",{className:"col-md-4 mb-3",children:[Object(j.jsx)("label",{htmlFor:"department",className:"form-label",children:"Department"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.m,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"department",name:"department",value:e.department,onChange:h,required:!0,placeholder:"Enter department"})]})]}),Object(j.jsxs)("div",{className:"col-md-4 mb-3",children:[Object(j.jsx)("label",{htmlFor:"year",className:"form-label",children:"Year"}),Object(j.jsxs)("select",{className:"form-select",id:"year",name:"year",value:e.year,onChange:h,required:!0,children:[Object(j.jsx)("option",{value:1,children:"1st Year"}),Object(j.jsx)("option",{value:2,children:"2nd Year"}),Object(j.jsx)("option",{value:3,children:"3rd Year"}),Object(j.jsx)("option",{value:4,children:"4th Year"}),Object(j.jsx)("option",{value:5,children:"5th Year"})]})]})]})}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary w-100 mb-3",disabled:d,children:d?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Creating Account..."]}):"Create Account"}),Object(j.jsx)("div",{className:"text-center",children:Object(j.jsxs)("p",{className:"mb-0",children:["Already have an account?"," ",Object(j.jsx)(n.b,{to:"/login",className:"text-primary fw-bold",children:"Sign in here"})]})})]})]})})})})};var g=()=>{const[e,t]=Object(a.useState)(""),[s,c]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1);return l?Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5 text-center",children:[Object(j.jsx)("div",{className:"mb-4",children:Object(j.jsx)(u.j,{className:"text-primary",style:{fontSize:"3rem"}})}),Object(j.jsx)("h3",{className:"fw-bold text-primary mb-3",children:"Check Your Email"}),Object(j.jsxs)("p",{className:"text-muted mb-4",children:["We've sent a password reset link to ",Object(j.jsx)("strong",{children:e})]}),Object(j.jsx)("p",{className:"text-muted small mb-4",children:"If you don't see the email, check your spam folder or try again."}),Object(j.jsx)("button",{className:"btn btn-outline-primary me-2",onClick:()=>r(!1),children:"Try Again"}),Object(j.jsx)(n.b,{to:"/login",className:"btn btn-primary",children:"Back to Login"})]})})})}):Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5",children:[Object(j.jsxs)("div",{className:"text-center mb-4",children:[Object(j.jsx)("h2",{className:"fw-bold text-primary",children:"Forgot Password"}),Object(j.jsx)("p",{className:"text-muted",children:"Enter your email to reset your password"})]}),Object(j.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),c(!0);try{(await o.a.post("/api/auth/forgot-password",{email:e})).data.success&&(r(!0),d.b.success("Password reset email sent successfully!"))}catch(l){var s,a;const e=(null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Failed to send reset email";d.b.error(e)}finally{c(!1)}},children:[Object(j.jsxs)("div",{className:"mb-4",children:[Object(j.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email Address"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.j,{})}),Object(j.jsx)("input",{type:"email",className:"form-control",id:"email",value:e,onChange:e=>t(e.target.value),required:!0,placeholder:"Enter your email"})]})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary w-100 mb-3",disabled:s,children:s?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Sending..."]}):"Send Reset Link"}),Object(j.jsx)("div",{className:"text-center",children:Object(j.jsxs)(n.b,{to:"/login",className:"text-decoration-none",children:[Object(j.jsx)(u.a,{className:"me-1"}),"Back to Login"]})})]})]})})})})};var y=()=>{const[e,t]=Object(a.useState)({password:"",confirmPassword:""}),[s,c]=Object(a.useState)(!1),[l,r]=Object(a.useState)(!1),[b,m]=Object(a.useState)(!1),[h,x]=Object(a.useState)(!0),[O,N]=Object(a.useState)(!1),[v,p]=Object(a.useState)(!1),{token:g}=Object(i.s)(),y=Object(i.q)();Object(a.useEffect)(()=>{w()},[g]);const w=async()=>{try{(await o.a.get(`/api/auth/reset-password/${g}`)).data.success&&N(!0)}catch(e){N(!1),d.b.error("Invalid or expired reset link")}finally{x(!1)}},f=s=>{t({...e,[s.target.name]:s.target.value})};return h?Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5 text-center",children:[Object(j.jsx)("div",{className:"spinner-border text-primary",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),Object(j.jsx)("p",{className:"mt-3 text-muted",children:"Validating reset link..."})]})})})}):O?v?Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5 text-center",children:[Object(j.jsx)("div",{className:"mb-4",children:Object(j.jsx)(u.e,{className:"text-success",style:{fontSize:"3rem"}})}),Object(j.jsx)("h3",{className:"fw-bold text-success mb-3",children:"Password Reset Successfully!"}),Object(j.jsx)("p",{className:"text-muted mb-4",children:"Your password has been updated. You will be redirected to login shortly."}),Object(j.jsx)(n.b,{to:"/login",className:"btn btn-primary",children:"Go to Login"})]})})})}):Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5",children:[Object(j.jsxs)("div",{className:"text-center mb-4",children:[Object(j.jsx)("h2",{className:"fw-bold text-primary",children:"Reset Password"}),Object(j.jsx)("p",{className:"text-muted",children:"Enter your new password"})]}),Object(j.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),m(!0),e.password!==e.confirmPassword)return d.b.error("Passwords do not match"),void m(!1);if(e.password.length<6)return d.b.error("Password must be at least 6 characters long"),void m(!1);try{(await o.a.post(`/api/auth/reset-password/${g}`,{password:e.password})).data.success&&(p(!0),d.b.success("Password reset successfully!"),setTimeout(()=>{y("/login")},2e3))}catch(c){var s,a;const e=(null===(s=c.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Failed to reset password";d.b.error(e)}finally{m(!1)}},children:[Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"password",className:"form-label",children:"New Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:s?"text":"password",className:"form-control",id:"password",name:"password",value:e.password,onChange:f,required:!0,placeholder:"Enter new password"}),Object(j.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>c(!s),children:s?Object(j.jsx)(u.l,{}):Object(j.jsx)(u.k,{})})]})]}),Object(j.jsxs)("div",{className:"mb-4",children:[Object(j.jsx)("label",{htmlFor:"confirmPassword",className:"form-label",children:"Confirm New Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:l?"text":"password",className:"form-control",id:"confirmPassword",name:"confirmPassword",value:e.confirmPassword,onChange:f,required:!0,placeholder:"Confirm new password"}),Object(j.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>r(!l),children:l?Object(j.jsx)(u.l,{}):Object(j.jsx)(u.k,{})})]})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary w-100 mb-3",disabled:b,children:b?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Resetting Password..."]}):"Reset Password"}),Object(j.jsx)("div",{className:"text-center",children:Object(j.jsx)(n.b,{to:"/login",className:"text-decoration-none",children:"Back to Login"})})]})]})})})}):Object(j.jsx)("div",{className:"row justify-content-center align-items-center min-vh-100",children:Object(j.jsx)("div",{className:"col-md-6 col-lg-4",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body p-5 text-center",children:[Object(j.jsx)("h3",{className:"fw-bold text-danger mb-3",children:"Invalid Reset Link"}),Object(j.jsx)("p",{className:"text-muted mb-4",children:"This password reset link is invalid or has expired."}),Object(j.jsx)(n.b,{to:"/forgot-password",className:"btn btn-primary",children:"Request New Reset Link"})]})})})})};var w=()=>{const[e,t]=Object(a.useState)({todayAttendance:0,activeQRCodes:0,totalStudents:0,recentActivity:[]}),[s,c]=Object(a.useState)(!0);Object(a.useEffect)(()=>{l()},[]);const l=async()=>{try{const e=(new Date).toISOString().split("T")[0],s=(await o.a.get(`/api/attendance/daily?date=${e}`)).data.data,a=(await o.a.get("/api/qr/active")).data.count,c=(await o.a.get("/api/auth/students")).data.count;t({todayAttendance:s.stats.total,activeQRCodes:a,totalStudents:c,recentActivity:s.attendance.slice(0,5)})}catch(e){console.error("Error fetching dashboard stats:",e)}finally{c(!1)}};return s?Object(j.jsx)("div",{className:"loading-spinner",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Teacher Dashboard"}),Object(j.jsx)("p",{className:"text-white-50",children:"Welcome back! Here's your overview for today."})]})}),Object(j.jsxs)("div",{className:"row mb-4",children:[Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:e.todayAttendance}),Object(j.jsx)("div",{className:"stats-label",children:"Today's Attendance"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:e.activeQRCodes}),Object(j.jsx)("div",{className:"stats-label",children:"Active QR Codes"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:e.totalStudents}),Object(j.jsx)("div",{className:"stats-label",children:"Total Students"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsxs)("div",{className:"stats-number",children:[e.totalStudents>0?Math.round(e.todayAttendance/e.totalStudents*100):0,"%"]}),Object(j.jsx)("div",{className:"stats-label",children:"Attendance Rate"})]})})]}),Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Quick Actions"}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsx)(n.b,{to:"/teacher/qr-generate",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.q,{className:"text-primary mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"Generate QR Code"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"Create a new QR code for attendance"})]})})})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsx)(n.b,{to:"/teacher/attendance",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.v,{className:"text-success mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"View Attendance"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"Check today's attendance records"})]})})})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsx)(n.b,{to:"/teacher/attendance",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.d,{className:"text-warning mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"Analytics"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"View attendance statistics"})]})})})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsx)(n.b,{to:"/teacher/attendance",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.b,{className:"text-info mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"History"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"View past attendance records"})]})})})})]})]})})})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Recent Activity"}),e.recentActivity.length>0?Object(j.jsx)("div",{className:"table-responsive",children:Object(j.jsxs)("table",{className:"table table-hover",children:[Object(j.jsx)("thead",{children:Object(j.jsxs)("tr",{children:[Object(j.jsx)("th",{children:"Student"}),Object(j.jsx)("th",{children:"Mobile Number"}),Object(j.jsx)("th",{children:"Description"}),Object(j.jsx)("th",{children:"Coordinates"}),Object(j.jsx)("th",{children:"Time"})]})}),Object(j.jsx)("tbody",{children:e.recentActivity.map(e=>{var t;return Object(j.jsxs)("tr",{children:[Object(j.jsxs)("td",{children:[Object(j.jsx)("strong",{children:e.student.name}),Object(j.jsx)("br",{}),Object(j.jsx)("small",{className:"text-muted",children:e.student.studentId})]}),Object(j.jsx)("td",{children:e.student.mobileNumber}),Object(j.jsx)("td",{children:(null===(t=e.qrCode)||void 0===t?void 0:t.description)||"N/A"}),Object(j.jsx)("td",{children:e.coordinates&&e.coordinates.latitude&&e.coordinates.longitude?Object(j.jsxs)("small",{className:"text-muted",children:[e.coordinates.latitude.toFixed(6),", ",e.coordinates.longitude.toFixed(6)]}):Object(j.jsx)("small",{className:"text-muted",children:"N/A"})}),Object(j.jsx)("td",{children:new Date(e.markedAt).toLocaleTimeString()})]},e._id)})})]})}):Object(j.jsx)("p",{className:"text-muted text-center",children:"No recent activity"})]})})})})]})};var f=()=>{const{user:e,isAuthenticated:t,token:s}=O(),[c,l]=Object(a.useState)({description:"",location:"",course:"",validityMinutes:10}),[r,n]=Object(a.useState)(null),[i,b]=Object(a.useState)(!1),m=e=>{l({...c,[e.target.name]:e.target.value})};return console.log("QR Generator - Auth State:",{isAuthenticated:t,user:e,token:s?"Present":"Missing",userRole:null===e||void 0===e?void 0:e.role}),t||e?e&&"teacher"!==e.role?Object(j.jsx)("div",{className:"row justify-content-center",children:Object(j.jsx)("div",{className:"col-md-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body text-center",children:[Object(j.jsx)("h3",{className:"text-danger",children:"Access Denied"}),Object(j.jsx)("p",{children:"Only teachers can generate QR codes."})]})})})}):Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Generate QR Code"}),Object(j.jsx)("p",{className:"text-white-50",children:"Create a new QR code for student attendance"})]})}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-md-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"QR Code Settings"}),Object(j.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),b(!0),!t||!s)return d.b.error("You must be logged in to generate QR codes"),void b(!1);if("teacher"!==(null===e||void 0===e?void 0:e.role))return d.b.error("Only teachers can generate QR codes"),void b(!1);console.log("Generating QR code with token:",s?"Present":"Missing"),console.log("User:",e),console.log("Axios headers:",o.a.defaults.headers.common);try{const e=await o.a.post("/api/qr/generate",c);n(e.data.data),d.b.success("QR Code generated successfully!")}catch(i){var l,r;console.error("QR generation error:",i);const e=(null===(l=i.response)||void 0===l||null===(r=l.data)||void 0===r?void 0:r.message)||"Failed to generate QR code";d.b.error(e)}finally{b(!1)}},children:[Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"description",className:"form-label",children:"Description"}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"description",name:"description",value:c.description,onChange:m,placeholder:"e.g., Morning Class Attendance"})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"location",className:"form-label",children:"Location"}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"location",name:"location",value:c.location,onChange:m,placeholder:"e.g., Room 101"})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"course",className:"form-label",children:"Course/Subject"}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"course",name:"course",value:c.course,onChange:m,placeholder:"e.g., Computer Science"})]}),Object(j.jsxs)("div",{className:"mb-4",children:[Object(j.jsx)("label",{htmlFor:"validityMinutes",className:"form-label",children:"Validity (minutes)"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.f,{})}),Object(j.jsx)("input",{type:"number",className:"form-control",id:"validityMinutes",name:"validityMinutes",value:c.validityMinutes,onChange:m,min:"1",max:"60"})]}),Object(j.jsx)("small",{className:"text-muted",children:"QR code will expire after this time"})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary w-100",disabled:i,children:i?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Generating QR Code..."]}):Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(u.q,{className:"me-2"}),"Generate QR Code"]})})]})]})})}),Object(j.jsx)("div",{className:"col-md-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Generated QR Code"}),r?Object(j.jsxs)("div",{className:"text-center",children:[Object(j.jsx)("div",{className:"qr-container mb-3",children:Object(j.jsx)("img",{src:r.qrCodeImage,alt:"QR Code",className:"img-fluid",style:{maxWidth:"300px"}})}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("strong",{children:"Code:"})," ",r.code]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("strong",{children:"Expires:"})," ",new Date(r.expiresAt).toLocaleString()]}),Object(j.jsxs)("div",{className:"d-grid gap-2",children:[Object(j.jsxs)("button",{className:"btn btn-outline-primary",onClick:()=>{r&&(navigator.clipboard.writeText(r.code),d.b.success("QR Code copied to clipboard!"))},children:[Object(j.jsx)(u.h,{className:"me-2"}),"Copy Code"]}),Object(j.jsxs)("button",{className:"btn btn-outline-success",onClick:()=>{if(r){const e=document.createElement("canvas"),t=e.getContext("2d"),s=new Image;s.onload=()=>{e.width=s.width,e.height=s.height,t.drawImage(s,0,0);const a=document.createElement("a");a.download=`qr-code-${r.code}.png`,a.href=e.toDataURL(),a.click()},s.src=r.qrCodeImage}},children:[Object(j.jsx)(u.i,{className:"me-2"}),"Download QR"]})]})]}):Object(j.jsxs)("div",{className:"text-center text-muted",children:[Object(j.jsx)(u.q,{size:100,className:"mb-3"}),Object(j.jsx)("p",{children:"Generate a QR code to see it here"})]})]})})})]}),r&&Object(j.jsx)("div",{className:"row mt-4",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"QR Code Details"}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Description:"})," ",r.description]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Location:"})," ",r.location]})]}),Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Course/Subject:"})," ",r.course]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Generated:"})," ",new Date(r.generatedAt).toLocaleString()]})]})]})]})})})})]}):Object(j.jsxs)("div",{className:"loading-spinner",children:[Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),Object(j.jsx)("p",{className:"mt-2 text-white",children:"Checking authentication..."})]})};var S=()=>{const[e,t]=Object(a.useState)([]),[s,c]=Object(a.useState)({}),[l,r]=Object(a.useState)((new Date).toISOString().split("T")[0]),[n,i]=Object(a.useState)(!0),b=Object(a.useCallback)(async()=>{try{i(!0);const e=await o.a.get(`/api/attendance/daily?date=${l}`);t(e.data.data.attendance),c(e.data.data.stats)}catch(e){console.error("Error fetching attendance:",e),d.b.error("Failed to fetch attendance data")}finally{i(!1)}},[l]);Object(a.useEffect)(()=>{b()},[b]);return n?Object(j.jsx)("div",{className:"loading-spinner",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Attendance View"}),Object(j.jsx)("p",{className:"text-white-50",children:"View and manage attendance records"})]})}),Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsx)("div",{className:"col-md-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsxs)("label",{htmlFor:"date",className:"form-label",children:[Object(j.jsx)(u.b,{className:"me-2"}),"Select Date"]}),Object(j.jsx)("input",{type:"date",className:"form-control",id:"date",value:l,onChange:e=>r(e.target.value)})]})})})}),Object(j.jsxs)("div",{className:"row mb-4",children:[Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.total||0}),Object(j.jsx)("div",{className:"stats-label",children:"Total Students"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.present||0}),Object(j.jsx)("div",{className:"stats-label",children:"Present"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.late||0}),Object(j.jsx)("div",{className:"stats-label",children:"Late"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsxs)("div",{className:"stats-number",children:[s.total>0?Math.round((s.present||0)/s.total*100):0,"%"]}),Object(j.jsx)("div",{className:"stats-label",children:"Attendance Rate"})]})})]}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[Object(j.jsx)("h5",{className:"card-title mb-0",children:"Attendance Records"}),Object(j.jsxs)("div",{children:[Object(j.jsxs)("button",{className:"btn btn-outline-primary btn-sm me-2",onClick:()=>window.print(),children:[Object(j.jsx)(u.k,{className:"me-1"}),"Print"]}),Object(j.jsxs)("button",{className:"btn btn-outline-success btn-sm",onClick:()=>{d.b.info("Export feature coming soon!")},children:[Object(j.jsx)(u.i,{className:"me-1"}),"Export"]})]})]}),e.length>0?Object(j.jsx)("div",{className:"table-responsive",children:Object(j.jsxs)("table",{className:"table table-hover attendance-table",children:[Object(j.jsx)("thead",{children:Object(j.jsxs)("tr",{children:[Object(j.jsx)("th",{children:"Student Name"}),Object(j.jsx)("th",{children:"Student ID"}),Object(j.jsx)("th",{children:"Department"}),Object(j.jsx)("th",{children:"Year"}),Object(j.jsx)("th",{children:"Mobile Number"}),Object(j.jsx)("th",{children:"Status"}),Object(j.jsx)("th",{children:"Time"}),Object(j.jsx)("th",{children:"Actions"})]})}),Object(j.jsx)("tbody",{children:e.map(e=>Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{children:Object(j.jsx)("strong",{children:e.student.name})}),Object(j.jsx)("td",{children:e.student.studentId}),Object(j.jsx)("td",{children:e.student.department}),Object(j.jsx)("td",{children:e.student.year}),Object(j.jsx)("td",{children:e.student.mobileNumber}),Object(j.jsx)("td",{children:Object(j.jsx)("span",{className:`status-badge status-${e.status}`,children:e.status})}),Object(j.jsx)("td",{children:new Date(e.markedAt).toLocaleTimeString()}),Object(j.jsx)("td",{children:Object(j.jsx)("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this attendance record?"))try{await o.a.delete(`/api/attendance/${e}`),d.b.success("Attendance record deleted successfully"),b()}catch(t){console.error("Error deleting attendance:",t),d.b.error("Failed to delete attendance record")}})(e._id),title:"Delete record",children:Object(j.jsx)(u.t,{})})})]},e._id))})]})}):Object(j.jsxs)("div",{className:"text-center text-muted py-4",children:[Object(j.jsx)(u.b,{size:50,className:"mb-3"}),Object(j.jsx)("p",{children:"No attendance records found for this date"})]})]})})})})]})};var C=()=>Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/",element:Object(j.jsx)(w,{})}),Object(j.jsx)(i.b,{path:"/qr-generate",element:Object(j.jsx)(f,{})}),Object(j.jsx)(i.b,{path:"/attendance",element:Object(j.jsx)(S,{})})]});var A=()=>{const{user:e}=O(),[t,s]=Object(a.useState)({totalAttendance:0,presentDays:0,lateDays:0,attendanceRate:0}),[c,l]=Object(a.useState)(!0);Object(a.useEffect)(()=>{r()},[]);const r=async()=>{try{const e=new Date;e.setDate(e.getDate()-30);const t=(await o.a.get("/api/attendance/my-attendance",{params:{startDate:e.toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0]}})).data.data,a=t.filter(e=>"present"===e.status).length,c=t.filter(e=>"late"===e.status).length,l=t.length;s({totalAttendance:l,presentDays:a,lateDays:c,attendanceRate:l>0?Math.round(a/l*100):0})}catch(e){console.error("Error fetching student stats:",e)}finally{l(!1)}};return c?Object(j.jsx)("div",{className:"loading-spinner",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Student Dashboard"}),Object(j.jsxs)("p",{className:"text-white-50",children:["Welcome back, ",null===e||void 0===e?void 0:e.name,"!"]})]})}),Object(j.jsxs)("div",{className:"row mb-4",children:[Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:t.totalAttendance}),Object(j.jsx)("div",{className:"stats-label",children:"Total Sessions"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:t.presentDays}),Object(j.jsx)("div",{className:"stats-label",children:"Present Days"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:t.lateDays}),Object(j.jsx)("div",{className:"stats-label",children:"Late Days"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsxs)("div",{className:"stats-number",children:[t.attendanceRate,"%"]}),Object(j.jsx)("div",{className:"stats-label",children:"Attendance Rate"})]})})]}),Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Quick Actions"}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-md-4 mb-3",children:Object(j.jsx)(n.b,{to:"/student/scan",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.q,{className:"text-primary mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"Scan QR Code"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"Mark your attendance"})]})})})}),Object(j.jsx)("div",{className:"col-md-4 mb-3",children:Object(j.jsx)(n.b,{to:"/student/my-attendance",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.b,{className:"text-success mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"My Attendance"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"View your attendance history"})]})})})}),Object(j.jsx)("div",{className:"col-md-4 mb-3",children:Object(j.jsx)(n.b,{to:"/profile",className:"text-decoration-none",children:Object(j.jsx)("div",{className:"card text-center h-100",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)(u.u,{className:"text-info mb-3",size:40}),Object(j.jsx)("h6",{className:"card-title",children:"Profile"}),Object(j.jsx)("p",{className:"card-text text-muted",children:"Update your profile"})]})})})})]})]})})})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Student Information"}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Name:"})," ",null===e||void 0===e?void 0:e.name]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Student ID:"})," ",null===e||void 0===e?void 0:e.studentId]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Email:"})," ",null===e||void 0===e?void 0:e.email]})]}),Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Department:"})," ",null===e||void 0===e?void 0:e.department]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Year:"})," ",null===e||void 0===e?void 0:e.year]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Mobile Number:"})," ",null===e||void 0===e?void 0:e.mobileNumber]})]})]})]})})})})]})},k=s(19);var P=()=>{const[e,t]=Object(a.useState)(!1),[s,c]=Object(a.useState)(null),[l,r]=Object(a.useState)(!1),n=Object(a.useRef)(null);Object(a.useEffect)(()=>()=>{n.current&&n.current.clear()},[]);const i=async e=>{e&&(t(!1),n.current&&n.current.clear(),c(e),await m(e))},b=e=>{console.error(e),d.b.error("Error scanning QR code")},m=async e=>{r(!0);try{const t=await new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude})},t=>{console.warn("Location access denied or unavailable:",t),e({latitude:null,longitude:null})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):e({latitude:null,longitude:null})}),s=await o.a.post("/api/qr/validate",{code:e});if(s.data.success){const e=await o.a.post("/api/attendance/mark",{qrCodeId:s.data.data._id,coordinates:t});e.data.success&&(d.b.success(e.data.message),c({success:!0,message:e.data.message,data:e.data.data}))}}catch(a){var t,s;const e=(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to mark attendance";d.b.error(e),c({success:!1,message:e})}finally{r(!1)}};return Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Scan QR Code"}),Object(j.jsx)("p",{className:"text-white-50",children:"Scan the QR code to mark your attendance"})]})}),Object(j.jsx)("div",{className:"row justify-content-center",children:Object(j.jsx)("div",{className:"col-md-8",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3 text-center",children:"QR Code Scanner"}),!e&&!s&&Object(j.jsxs)("div",{className:"text-center",children:[Object(j.jsx)(u.q,{size:100,className:"text-muted mb-3"}),Object(j.jsx)("p",{className:"text-muted",children:"Click the button below to start scanning"}),Object(j.jsxs)("button",{className:"btn btn-primary",onClick:()=>{t(!0),c(null),setTimeout(()=>{n.current&&n.current.clear(),n.current=new k.a("qr-reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1},!1),n.current.render(i,b)},100)},children:[Object(j.jsx)(u.c,{className:"me-2"}),"Start Scanning"]})]}),e&&Object(j.jsxs)("div",{className:"text-center",children:[Object(j.jsx)("div",{className:"scanner-container mb-3",children:Object(j.jsx)("div",{id:"qr-reader"})}),Object(j.jsx)("p",{className:"text-muted",children:"Point your camera at the QR code"}),Object(j.jsx)("button",{className:"btn btn-secondary",onClick:()=>{t(!1),n.current&&n.current.clear()},children:"Cancel"})]}),s&&Object(j.jsxs)("div",{className:"text-center",children:[s.success?Object(j.jsxs)("div",{className:"alert alert-success",children:[Object(j.jsx)(u.e,{className:"me-2"}),s.message]}):Object(j.jsxs)("div",{className:"alert alert-danger",children:[Object(j.jsx)(u.s,{className:"me-2"}),s.message]}),Object(j.jsx)("div",{className:"mt-3",children:Object(j.jsx)("button",{className:"btn btn-primary me-2",onClick:()=>{t(!0),c(null)},disabled:l,children:l?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Processing..."]}):Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(u.q,{className:"me-2"}),"Scan Another"]})})})]})]})})})}),Object(j.jsx)("div",{className:"row mt-4",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Instructions"}),Object(j.jsxs)("ul",{className:"list-unstyled",children:[Object(j.jsxs)("li",{className:"mb-2",children:[Object(j.jsx)("strong",{children:"1."}),' Click "Start Scanning" to activate your camera']}),Object(j.jsxs)("li",{className:"mb-2",children:[Object(j.jsx)("strong",{children:"2."})," Point your camera at the QR code displayed by your teacher"]}),Object(j.jsxs)("li",{className:"mb-2",children:[Object(j.jsx)("strong",{children:"3."})," Hold steady until the QR code is detected"]}),Object(j.jsxs)("li",{className:"mb-2",children:[Object(j.jsx)("strong",{children:"4."})," Your attendance will be automatically marked"]}),Object(j.jsxs)("li",{className:"mb-2",children:[Object(j.jsx)("strong",{children:"5."})," You can only mark attendance once per QR code"]})]})]})})})})]})};var R=()=>{const[e,t]=Object(a.useState)([]),[s,c]=Object(a.useState)({total:0,present:0,late:0,attendanceRate:0}),[l,r]=Object(a.useState)(new Date(Date.now()-2592e6).toISOString().split("T")[0]),[n,d]=Object(a.useState)((new Date).toISOString().split("T")[0]),[i,b]=Object(a.useState)(!0),m=Object(a.useCallback)(async()=>{try{b(!0),console.log("Fetching attendance with params:",{startDate:l,endDate:n}),console.log("Axios headers:",o.a.defaults.headers.common);const e=await o.a.get("/api/attendance/my-attendance",{params:{startDate:l,endDate:n}});console.log("Attendance response:",e.data);const s=e.data.data;t(s);const a=s.filter(e=>"present"===e.status).length,r=s.filter(e=>"late"===e.status).length,d=s.length;c({total:d,present:a,late:r,attendanceRate:d>0?Math.round(a/d*100):0})}catch(s){var e;console.error("Error fetching attendance:",s),console.error("Error response:",null===(e=s.response)||void 0===e?void 0:e.data)}finally{b(!1)}},[l,n]);return Object(a.useEffect)(()=>{m()},[m]),i?Object(j.jsx)("div",{className:"loading-spinner",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"My Attendance"}),Object(j.jsx)("p",{className:"text-white-50",children:"View your attendance history"})]})}),Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsx)("div",{className:"col-md-6",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsxs)("h6",{className:"card-title mb-3",children:[Object(j.jsx)(u.b,{className:"me-2"}),"Date Range"]}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"startDate",className:"form-label",children:"Start Date"}),Object(j.jsx)("input",{type:"date",className:"form-control",id:"startDate",value:l,onChange:e=>r(e.target.value)})]}),Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"endDate",className:"form-label",children:"End Date"}),Object(j.jsx)("input",{type:"date",className:"form-control",id:"endDate",value:n,onChange:e=>d(e.target.value)})]})]})]})})})}),Object(j.jsxs)("div",{className:"row mb-4",children:[Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.total}),Object(j.jsx)("div",{className:"stats-label",children:"Total Sessions"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.present}),Object(j.jsx)("div",{className:"stats-label",children:"Present"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsx)("div",{className:"stats-number",children:s.late}),Object(j.jsx)("div",{className:"stats-label",children:"Late"})]})}),Object(j.jsx)("div",{className:"col-md-3 mb-3",children:Object(j.jsxs)("div",{className:"stats-card",children:[Object(j.jsxs)("div",{className:"stats-number",children:[s.attendanceRate,"%"]}),Object(j.jsx)("div",{className:"stats-label",children:"Attendance Rate"})]})})]}),Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[Object(j.jsxs)("h5",{className:"card-title mb-0",children:[Object(j.jsx)(u.d,{className:"me-2"}),"Attendance History"]}),Object(j.jsxs)("span",{className:"text-muted",children:[e.length," records found"]})]}),e.length>0?Object(j.jsx)("div",{className:"table-responsive",children:Object(j.jsxs)("table",{className:"table table-hover attendance-table",children:[Object(j.jsx)("thead",{children:Object(j.jsxs)("tr",{children:[Object(j.jsx)("th",{children:"Date"}),Object(j.jsx)("th",{children:"Status"}),Object(j.jsx)("th",{children:"Time"}),Object(j.jsx)("th",{children:"Location"}),Object(j.jsx)("th",{children:"Course"}),Object(j.jsx)("th",{children:"Teacher"})]})}),Object(j.jsx)("tbody",{children:e.map(e=>{var t;return Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{children:Object(j.jsx)("strong",{children:new Date(e.date).toLocaleDateString()})}),Object(j.jsx)("td",{children:Object(j.jsx)("span",{className:`status-badge status-${e.status}`,children:e.status})}),Object(j.jsx)("td",{children:new Date(e.markedAt).toLocaleTimeString()}),Object(j.jsx)("td",{children:e.location}),Object(j.jsx)("td",{children:e.course}),Object(j.jsx)("td",{children:(null===(t=e.teacher)||void 0===t?void 0:t.name)||"N/A"})]},e._id)})})]})}):Object(j.jsxs)("div",{className:"text-center text-muted py-4",children:[Object(j.jsx)(u.b,{size:50,className:"mb-3"}),Object(j.jsx)("p",{children:"No attendance records found for the selected date range"})]})]})})})}),e.length>0&&Object(j.jsx)("div",{className:"row mt-4",children:Object(j.jsx)("div",{className:"col-12",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Attendance Summary"}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Total Sessions:"})," ",s.total]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Present Days:"})," ",s.present]})]}),Object(j.jsxs)("div",{className:"col-md-6",children:[Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Late Days:"})," ",s.late]}),Object(j.jsxs)("p",{children:[Object(j.jsx)("strong",{children:"Attendance Rate:"})," ",s.attendanceRate,"%"]})]})]})]})})})})]})};var D=()=>Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/",element:Object(j.jsx)(A,{})}),Object(j.jsx)(i.b,{path:"/scan",element:Object(j.jsx)(P,{})}),Object(j.jsx)(i.b,{path:"/my-attendance",element:Object(j.jsx)(R,{})})]});var I=()=>{const{user:e,updateProfile:t,changePassword:s}=O(),[c,l]=Object(a.useState)("profile"),[r,n]=Object(a.useState)({name:(null===e||void 0===e?void 0:e.name)||"",email:(null===e||void 0===e?void 0:e.email)||"",mobileNumber:(null===e||void 0===e?void 0:e.mobileNumber)||"",department:(null===e||void 0===e?void 0:e.department)||"",year:(null===e||void 0===e?void 0:e.year)||1}),[d,i]=Object(a.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[o,b]=Object(a.useState)(!1),m=e=>{n({...r,[e.target.name]:e.target.value})},h=e=>{i({...d,[e.target.name]:e.target.value})};return Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"row mb-4",children:Object(j.jsxs)("div",{className:"col-12",children:[Object(j.jsx)("h2",{className:"fw-bold text-white",children:"Profile"}),Object(j.jsx)("p",{className:"text-white-50",children:"Manage your account information"})]})}),Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"col-md-3",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsx)("div",{className:"card-body",children:Object(j.jsxs)("div",{className:"nav flex-column nav-pills",children:[Object(j.jsxs)("button",{className:"nav-link "+("profile"===c?"active":""),onClick:()=>l("profile"),children:[Object(j.jsx)(u.u,{className:"me-2"}),"Profile Information"]}),Object(j.jsxs)("button",{className:"nav-link "+("password"===c?"active":""),onClick:()=>l("password"),children:[Object(j.jsx)(u.o,{className:"me-2"}),"Change Password"]})]})})})}),Object(j.jsx)("div",{className:"col-md-9",children:Object(j.jsx)("div",{className:"card",children:Object(j.jsx)("div",{className:"card-body",children:"profile"===c?Object(j.jsxs)("div",{children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Profile Information"}),Object(j.jsxs)("form",{onSubmit:async s=>{s.preventDefault(),b(!0);try{(await t(r)).success&&n({name:(null===e||void 0===e?void 0:e.name)||"",email:(null===e||void 0===e?void 0:e.email)||"",mobileNumber:(null===e||void 0===e?void 0:e.mobileNumber)||"",department:(null===e||void 0===e?void 0:e.department)||"",year:(null===e||void 0===e?void 0:e.year)||1})}catch(a){console.error("Profile update error:",a)}finally{b(!1)}},children:[Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"name",className:"form-label",children:"Full Name"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.u,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"name",name:"name",value:r.name,onChange:m,required:!0})]})]}),Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email Address"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.j,{})}),Object(j.jsx)("input",{type:"email",className:"form-control",id:"email",name:"email",value:r.email,onChange:m,required:!0})]})]})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"mobileNumber",className:"form-label",children:"Mobile Number"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.p,{})}),Object(j.jsx)("input",{type:"tel",className:"form-control",id:"mobileNumber",name:"mobileNumber",value:r.mobileNumber,onChange:m,required:!0,placeholder:"Enter your 10-digit mobile number",maxLength:"10"})]})]}),"student"===(null===e||void 0===e?void 0:e.role)&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"row",children:[Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"studentId",className:"form-label",children:"Student ID"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.n,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"studentId",value:null===e||void 0===e?void 0:e.studentId,disabled:!0})]}),Object(j.jsx)("small",{className:"text-muted",children:"Student ID cannot be changed"})]}),Object(j.jsxs)("div",{className:"col-md-6 mb-3",children:[Object(j.jsx)("label",{htmlFor:"department",className:"form-label",children:"Department"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.m,{})}),Object(j.jsx)("input",{type:"text",className:"form-control",id:"department",name:"department",value:r.department,onChange:m,required:!0})]})]})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"year",className:"form-label",children:"Year"}),Object(j.jsxs)("select",{className:"form-select",id:"year",name:"year",value:r.year,onChange:m,required:!0,children:[Object(j.jsx)("option",{value:1,children:"1st Year"}),Object(j.jsx)("option",{value:2,children:"2nd Year"})]})]})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Updating..."]}):"Update Profile"})]})]}):Object(j.jsxs)("div",{children:[Object(j.jsx)("h5",{className:"card-title mb-3",children:"Change Password"}),Object(j.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d.newPassword===d.confirmPassword)if(d.newPassword.length<6)alert("New password must be at least 6 characters long");else{b(!0);try{(await s(d.currentPassword,d.newPassword)).success&&i({currentPassword:"",newPassword:"",confirmPassword:""})}catch(t){console.error("Password change error:",t)}finally{b(!1)}}else alert("New passwords do not match")},children:[Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"currentPassword",className:"form-label",children:"Current Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:"password",className:"form-control",id:"currentPassword",name:"currentPassword",value:d.currentPassword,onChange:h,required:!0})]})]}),Object(j.jsxs)("div",{className:"mb-3",children:[Object(j.jsx)("label",{htmlFor:"newPassword",className:"form-label",children:"New Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:"password",className:"form-control",id:"newPassword",name:"newPassword",value:d.newPassword,onChange:h,required:!0})]})]}),Object(j.jsxs)("div",{className:"mb-4",children:[Object(j.jsx)("label",{htmlFor:"confirmPassword",className:"form-label",children:"Confirm New Password"}),Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("span",{className:"input-group-text",children:Object(j.jsx)(u.o,{})}),Object(j.jsx)("input",{type:"password",className:"form-control",id:"confirmPassword",name:"confirmPassword",value:d.confirmPassword,onChange:h,required:!0})]})]}),Object(j.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Changing Password..."]}):"Change Password"})]})]})})})})]})]})};var F=()=>Object(j.jsx)("div",{className:"loading-spinner",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden",children:"Loading..."})})});var L=()=>{const{isAuthenticated:e,loading:t,user:s}=O();return console.log("App - Auth State:",{isAuthenticated:e,loading:t,user:null===s||void 0===s?void 0:s.name,role:null===s||void 0===s?void 0:s.role}),t?Object(j.jsx)(F,{}):e?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(N,{}),Object(j.jsx)("div",{className:"container mt-4",children:Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/",element:"teacher"===(null===s||void 0===s?void 0:s.role)?Object(j.jsx)(i.a,{to:"/teacher",replace:!0}):Object(j.jsx)(i.a,{to:"/student",replace:!0})}),Object(j.jsx)(i.b,{path:"/teacher/*",element:"teacher"===(null===s||void 0===s?void 0:s.role)?Object(j.jsx)(C,{}):Object(j.jsx)(i.a,{to:"/student",replace:!0})}),Object(j.jsx)(i.b,{path:"/student/*",element:"student"===(null===s||void 0===s?void 0:s.role)?Object(j.jsx)(D,{}):Object(j.jsx)(i.a,{to:"/teacher",replace:!0})}),Object(j.jsx)(i.b,{path:"/profile",element:Object(j.jsx)(I,{})}),Object(j.jsx)(i.b,{path:"*",element:Object(j.jsx)(i.a,{to:"/",replace:!0})})]})})]}):(console.log("App - Not authenticated, showing login routes"),Object(j.jsx)("div",{className:"container",children:Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/login",element:Object(j.jsx)(v,{})}),Object(j.jsx)(i.b,{path:"/register",element:Object(j.jsx)(p,{})}),Object(j.jsx)(i.b,{path:"/forgot-password",element:Object(j.jsx)(g,{})}),Object(j.jsx)(i.b,{path:"/reset-password/:token",element:Object(j.jsx)(y,{})}),Object(j.jsx)(i.b,{path:"*",element:Object(j.jsx)(i.a,{to:"/login",replace:!0})})]})}))};r.a.createRoot(document.getElementById("root")).render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(n.a,{children:Object(j.jsxs)(x,{children:[Object(j.jsx)(L,{}),Object(j.jsx)(d.a,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})})}))}},[[33,1,2]]]);
//# sourceMappingURL=main.2f948856.chunk.js.map